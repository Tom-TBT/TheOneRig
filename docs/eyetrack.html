---

title: Eye tracking 


keywords: fastai
sidebar: home_sidebar

summary: "Ensemble of functions aimed to compensate for the mouse eye motions"
description: "Ensemble of functions aimed to compensate for the mouse eye motions"
nb_path: "06_eyetrack.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 06_eyetrack.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="interpolate_screen_pos" class="doc_header"><code>interpolate_screen_pos</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/eyetrack.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>interpolate_screen_pos</code>(<strong><code>screen_pos</code></strong>, <strong><code>xnew</code></strong>, <strong><code>ynew</code></strong>, <strong><code>kind</code></strong>=<em><code>'linear'</code></em>)</p>
</blockquote>
<p>Interpolate the position of the xnew and ynew pixels from the original screen_pos.
<a href="/theonerig/eyetrack.html#interpolate_checker_pos"><code>interpolate_checker_pos</code></a> should be used instead as it's more user friendly.
params:</p>

<pre><code>- screen_pos: Screen positions in shape (17, 10, 2) obtained from calibration (from 80x80 pixel checker corners on a 1280x720px screen)
- xnew: New pixels indexes in x, in interval [0, 17[
- ynew: New pixels indexes in y, in interval [0, 10[
</code></pre>
<p>return:</p>

<pre><code>- Screen positions in shape (len(xnew),len(ynew), 2)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="interpolate_checker_pos" class="doc_header"><code>interpolate_checker_pos</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/eyetrack.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>interpolate_checker_pos</code>(<strong><code>screen_pos</code></strong>, <strong><code>width_box</code></strong>, <strong><code>height_box</code></strong>, <strong><code>kind</code></strong>=<em><code>'linear'</code></em>)</p>
</blockquote>
<p>Interpolate the centre of the checkerboard pixels from the screen calibrated position.
params:</p>

<pre><code>- screen_pos: Screen positions in shape (17, 10, 2) obtained from calibration (from 80x80 pixel checker corners on a 1280x720px screen)
- width_box: Width in pixel of a box
- height_box: Height in pixel of a box
- kind: kind of interpolation in {'linear', 'cubic', 'quintic'}</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_eye_events" class="doc_header"><code>split_eye_events</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/eyetrack.py#L49" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_eye_events</code>(<strong><code>eye_tracking</code></strong>, <strong><code>eps</code></strong>=<em><code>2</code></em>)</p>
</blockquote>
<p>Split the record where the eye moves. Detection done with clustering on X,Y and time of the eye position.</p>
<p>params:</p>

<pre><code>- eye_tracking: Eye traking array of the ellipse fit, in shape (t, (x,y,width,height,angle))
- eps: Distance to detect eye movements. Adjust this parameter if results are not satisfying
- kind: kind of interpolation in {'linear', 'cubic', 'quintic'}
</code></pre>
<p>return:</p>

<pre><code>- move_indexes, blink_indexes, noise_indexes</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_spherical_map" class="doc_header"><code>get_spherical_map</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/eyetrack.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_spherical_map</code>(<strong><code>screen_pos</code></strong>, <strong><code>input_res</code></strong>=<em><code>(281, 500)</code></em>, <strong><code>output_res</code></strong>=<em><code>(360, 640)</code></em>, <strong><code>k_side</code></strong>=<em><code>2</code></em>)</p>
</blockquote>
<p>Generate the mapping from normal image to an image projected on a spherical screen
params:</p>

<pre><code>- screen_pos: Screen positions in shape (17, 10, (elev, azim)) obtained from calibration (from 80x80 pixel checker corners on a 1280x720px screen)
- input_res: resolution of the input image
- output_res: resolution of the output image
- k_side: Kernel side's size to fill holes in the mapped image (2 -&gt; 5*5 kernel)
</code></pre>
<p>returns:</p>

<pre><code>- A mapping to be used in [`apply_spherical_map`](/theonerig/eyetrack.html#apply_spherical_map)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="apply_spherical_map" class="doc_header"><code>apply_spherical_map</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/eyetrack.py#L113" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>apply_spherical_map</code>(<strong><code>img_src</code></strong>, <strong><code>mapping</code></strong>, <strong><code>output_res</code></strong>=<em><code>(360, 640)</code></em>, <strong><code>f_fill</code></strong>=<em><code>mean</code></em>)</p>
</blockquote>
<p>Apply a mapping to an input image
params:</p>

<pre><code>- img_src: Source image to transform
- mapping: Mapping obtained from [`get_spherical_map`](/theonerig/eyetrack.html#get_spherical_map)
- output_res: Output resolution. Must match the parameter given to [`get_spherical_map`](/theonerig/eyetrack.html#get_spherical_map)
- f_fill: Function to apply when filling the holes (e.g. np.median, np.mean)
</code></pre>
<p>return:</p>

<pre><code>- The transformed image</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

