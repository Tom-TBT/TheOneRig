---

title: Utils

keywords: fastai
sidebar: home_sidebar

summary: "Useful functions to reshape/arrange/reduce raw data into clean data to add to the record"
description: "Useful functions to reshape/arrange/reduce raw data into clean data to add to the record"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.test</span> <span class="kn">import</span> <span class="n">test_eq</span>
<span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extend_sync_timepoints" class="doc_header"><code>extend_sync_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extend_sync_timepoints</code>(<strong><code>timepoints</code></strong>:<code>ndarray</code>, <strong><code>signals</code></strong>:<code>ndarray</code>, <strong><code>up_bound</code></strong>, <strong><code>low_bound</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>From <code>timepoints</code> and <code>signals</code> list, extend it on the left so it includes <code>low_bound</code>, and extend it
up to <code>up_bound</code>.
The number of frame added to the left can be found in the signal_chunk.idx</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It extends the timepoints by finding the typical distance between timepoints so it includes both left and right limits.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="align_sync_timepoints" class="doc_header"><code>align_sync_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>align_sync_timepoints</code>(<strong><code>timepoints</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>, <strong><code>signals</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>, <strong><code>ref_signals</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p>Align the <code>signals</code> of a <code>timepoints</code> timeserie to a reference <code>ref_timepoints</code> with the corresponding
<code>ref_signals</code>. <code>ref_timepoints</code> and <code>ref_signals</code> are potentially extended and returned
Returns a DataChunk of the aligned timepoints</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resample_to_timepoints" class="doc_header"><code>resample_to_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L101" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resample_to_timepoints</code>(<strong><code>timepoints</code></strong>:<code>ndarray</code>, <strong><code>data</code></strong>:<code>ndarray</code>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>, <strong><code>group</code></strong>=<em><code>'data'</code></em>)</p>
</blockquote>
<p>Resample the <code>data</code> at the <code>timepoints</code> to an array at the timepoints of <code>ref_timepoints</code>.
Return a DataChunck of the resampled data belonging to <code>group</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flip_stimulus" class="doc_header"><code>flip_stimulus</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L128" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flip_stimulus</code>(<strong><code>stim_inten</code></strong>, <strong><code>ud_inv</code></strong>, <strong><code>lr_inv</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flip_gratings" class="doc_header"><code>flip_gratings</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flip_gratings</code>(<strong><code>stim_shader</code></strong>, <strong><code>ud_inv</code></strong>, <strong><code>lr_inv</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_to_dataChunk" class="doc_header"><code>stim_to_dataChunk</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_to_dataChunk</code>(<strong><code>stim_inten</code></strong>, <strong><code>stim_start_idx</code></strong>, <strong><code>reference</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p>Factory function for DataChunk of a stimulus</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="spike_to_dataChunk" class="doc_header"><code>spike_to_dataChunk</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L151" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>spike_to_dataChunk</code>(<strong><code>spike_timepoints</code></strong>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p><code>spike_timepoints</code> must be a dictionnary of cell spike_timepoints list. This function then
bins the</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_stim_args" class="doc_header"><code>parse_stim_args</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_stim_args</code>(<strong><code>stim_name</code></strong>, <strong><code>stim_ref</code></strong>)</p>
</blockquote>
<p>Function really specific to Asari Lab stimuli. Stimuli were stored as h5 files. This function parse
the attributes of the stimuli that were stored in the h5 references of the stimuli.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="peak_sta_frame" class="doc_header"><code>peak_sta_frame</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L192" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>peak_sta_frame</code>(<strong><code>sta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_inten_norm" class="doc_header"><code>stim_inten_norm</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L197" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_inten_norm</code>(<strong><code>stim_inten</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="twoP_dataChunks" class="doc_header"><code>twoP_dataChunks</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>twoP_dataChunks</code>(<strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core#DataChunk"><code>DataChunk</code></a>, <strong><code>frame_timepoints</code></strong>, <strong><code>len_epochs</code></strong>, <strong><code>C_matrix</code></strong>, <strong><code>S_matrix</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="img_2d_fit" class="doc_header"><code>img_2d_fit</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L228" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>img_2d_fit</code>(<strong><code>shape</code></strong>, <strong><code>param_d</code></strong>, <strong><code>f</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fill_nan" class="doc_header"><code>fill_nan</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L234" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fill_nan</code>(<strong><code>A</code></strong>)</p>
</blockquote>
<p>interpolate to fill nan values. BRYAN WOODS@StackOverflow</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_direction_response" class="doc_header"><code>group_direction_response</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L245" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_direction_response</code>(<strong><code>stim_prop</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeat</code></strong>, <strong><code>n_cond</code></strong>=<em><code>32</code></em>)</p>
</blockquote>
<p>Group the record according to conditions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_chirp_bumps" class="doc_header"><code>group_chirp_bumps</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L267" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_chirp_bumps</code>(<strong><code>stim_inten</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeat</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="buszaki_shank_channels" class="doc_header"><code>buszaki_shank_channels</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L308" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>buszaki_shank_channels</code>(<strong><code>channel_positions</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="phy_results_dict" class="doc_header"><code>phy_results_dict</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L326" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>phy_results_dict</code>(<strong><code>phy_dir</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_pval" class="doc_header"><code>format_pval</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L338" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_pval</code>(<strong><code>pval</code></strong>, <strong><code>significant_figures</code></strong>=<em><code>2</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_calcium_stack_lenghts" class="doc_header"><code>get_calcium_stack_lenghts</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L342" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_calcium_stack_lenghts</code>(<strong><code>folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_repeat_corrected" class="doc_header"><code>get_repeat_corrected</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L352" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_repeat_corrected</code>(<strong><code>stim_inten</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeats</code></strong>=<em><code>10</code></em>)</p>
</blockquote>
<p>Correct the stimulus shifts before averaging the spikes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_recap_df" class="doc_header"><code>stim_recap_df</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L380" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_recap_df</code>(<strong><code>reM</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_recap_df_old" class="doc_header"><code>stim_recap_df_old</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L438" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_recap_df_old</code>(<strong><code>h5_stim_group</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

