---

title: leddome


keywords: fastai
sidebar: home_sidebar

summary: "Function related to the LED dome hardware"
description: "Function related to the LED dome hardware"
nb_path: "13_leddome.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 13_leddome.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dome_positions" class="doc_header"><code>get_dome_positions</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dome_positions</code>(<strong><code>mode</code></strong>=<em><code>'cartesian'</code></em>)</p>
</blockquote>
<p>Generates positions of all LEDs of the dome. Position of first and last LED of each stripe
were estimated in Blender, and other in between LEDs position are interpolated from those two.</p>
<p>params:</p>

<pre><code>- mode: What coordinates to obtain in set ["cartesian", "spherical"]
</code></pre>
<p>return:</p>

<pre><code>- LED position of the LED dome, in shape (4, 237). shape[0] organized by quarter (q1 to q4) and shape[1] is the
concatenation of (left,right)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="as_cartesian" class="doc_header"><code>as_cartesian</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>as_cartesian</code>(<strong><code>rthetaphi</code></strong>, <strong><code>is_radian</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Convert 3D polar coordinate tuple into cartesian coordinates.</p>
<p>params:</p>

<pre><code>- rthetaphi: Single or list of (r, theta, phi) iterable
- is_radian: Boolean to specify if in radians or in degrees
</code></pre>
<p>return:</p>

<pre><code>- Single or list of converted (x, y, z) array.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="as_spherical" class="doc_header"><code>as_spherical</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>as_spherical</code>(<strong><code>xyz</code></strong>)</p>
</blockquote>
<p>Convert 3D cartesian coordinates tuple into polar coordinate.</p>
<p>params:</p>

<pre><code>- xyz: Single or list of (x, y, z) iterable
</code></pre>
<p>return:</p>

<pre><code>- Single or list of converted (r, theta, phi) array.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_dome_positions</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[[ 1.00911709e+02,  1.45941156e+00,  1.48787652e+00],
        [ 1.00913992e+02,  1.39316057e+00,  1.48574122e+00],
        [ 1.00917188e+02,  1.32691399e+00,  1.48355455e+00],
        ...,
        [ 1.00994145e+02,  1.82982730e-01,  1.80999280e+00],
        [ 1.00994632e+02,  1.19911782e-01,  1.94309113e+00],
        [ 1.00994918e+02,  6.32134647e-02,  2.33532331e+00]],

       [[ 1.00911709e+02,  1.45941156e+00, -8.29198024e-02],
        [ 1.00913992e+02,  1.39316057e+00, -8.50551089e-02],
        [ 1.00917188e+02,  1.32691399e+00, -8.72417763e-02],
        ...,
        [ 1.00994145e+02,  1.82982730e-01,  2.39196471e-01],
        [ 1.00994632e+02,  1.19911782e-01,  3.72294808e-01],
        [ 1.00994918e+02,  6.32134647e-02,  7.64526983e-01]],

       [[ 1.00911709e+02,  1.45941156e+00, -1.65371613e+00],
        [ 1.00913992e+02,  1.39316057e+00, -1.65585144e+00],
        [ 1.00917188e+02,  1.32691399e+00, -1.65803810e+00],
        ...,
        [ 1.00994145e+02,  1.82982730e-01, -1.33159986e+00],
        [ 1.00994632e+02,  1.19911782e-01, -1.19850152e+00],
        [ 1.00994918e+02,  6.32134647e-02, -8.06269344e-01]],

       [[ 1.00911709e+02,  1.45941156e+00,  3.05867285e+00],
        [ 1.00913992e+02,  1.39316057e+00,  3.05653754e+00],
        [ 1.00917188e+02,  1.32691399e+00,  3.05435088e+00],
        ...,
        [ 1.00994145e+02,  1.82982730e-01, -2.90239618e+00],
        [ 1.00994632e+02,  1.19911782e-01, -2.76929785e+00],
        [ 1.00994918e+02,  6.32134647e-02, -2.37706567e+00]]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_wave_stimulus_array" class="doc_header"><code>build_wave_stimulus_array</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L174" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_wave_stimulus_array</code>(<strong><code>epoch_sequence</code></strong>, <strong><code>wave_width</code></strong>=<em><code>0.58</code></em>, <strong><code>wave_speed</code></strong>=<em><code>0.58</code></em>, <strong><code>n_frame_epoch</code></strong>=<em><code>640</code></em>, <strong><code>n_frame_isi</code></strong>=<em><code>50</code></em>, <strong><code>frame_rate</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Build the numpy stimulus matrix of the LED values for each frame.
params:</p>

<pre><code>- epoch_sequence: Sequence of indexes played randomly during the stimulation
- wave_width: Width of the wave in radians
- wave_speed: Speed of the wave in radians.s-1
- n_frame_epoch: Number of frames that an epoch last
- n_frame_isi: Number of frames during teh inter-stimulus-interval
- frame_rate: Frame rate of the display
</code></pre>
<p>returns:</p>

<pre><code>- LED values for the wave stimulus, in shape (t, 4, 237), where t=n_epoch*(n_frame_epoch+n_frame_isi)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Quaternion" class="doc_header"><code>class</code> <code>Quaternion</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L230" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Quaternion</code>(<strong><code>q0</code></strong>, <strong><code>qx</code></strong>, <strong><code>qy</code></strong>, <strong><code>qz</code></strong>)</p>
</blockquote>
<p>Simplified Quaternion class for rotation of normalized vectors only!</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_waves_relative_position" class="doc_header"><code>get_waves_relative_position</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_waves_relative_position</code>(<strong><code>ref_led_flat_idx</code></strong>, <strong><code>n_waves</code></strong>=<em><code>100</code></em>, <strong><code>mode</code></strong>=<em><code>'spherical'</code></em>)</p>
</blockquote>
<p>Rotate the waves origins to obtain for the ref_led_flat_idx a spherical position of (0,0)
params:</p>

<pre><code>- ref_led_flat_idx: Flattened index of the reference LED (e.g. obtained with np.argmax on abs STA values)
- n_waves: Number of waves in the wave stimulus (positions/density of waves determined by this parameter)
- mode: One of ["spherical", "cartesian"], for the returned position
</code></pre>
<p>return:</p>

<pre><code>- The rotated waves position</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_led_relative_position" class="doc_header"><code>get_led_relative_position</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/leddome.py#L328" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_led_relative_position</code>(<strong><code>ref_led_flat_idx</code></strong>, <strong><code>mode</code></strong>=<em><code>'spherical'</code></em>)</p>
</blockquote>
<p>Rotate the LED positions to obtain for the ref_led_flat_idx a spherical position of (0,0)
params:</p>

<pre><code>- ref_led_flat_idx: Flattened index of the reference LED (e.g. obtained with np.argmax on abs STA values)
- mode: One of ["spherical", "cartesian"], for the returned position
</code></pre>
<p>return:</p>

<pre><code>- The rotated LED position</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

